{% extends 'adminBase.html.twig' %}

{% block title %}Détails - Commande {{ order.reference }} - Tiramisou
{% endblock %}

{% block body %}
	<div class="container my-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h1>Détails - Commande {{ order.reference }}</h1>
			<a href="{{ path('admin.orders') }}" class="btn btn-secondary">Retour à la liste</a>
		</div>

		<div class="row">
			<div class="col-md-6 mb-4">
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">Informations générales</h5>
					</div>
					<div class="card-body">
						<p>
							<strong>Référence :</strong>
							{{ order.reference }}
						</p>
						<p>
							<strong>Statut :</strong>
							{% if order.status.value == 'in_preparation' %}
								<span class="badge bg-warning">En préparation</span>
							{% elseif order.status.value == 'shipped' %}
								<span class="badge bg-info">Expédiée</span>
							{% elseif order.status.value == 'delivered' %}
								<span class="badge bg-success">Livrée</span>
							{% elseif order.status.value == 'cancelled' %}
								<span class="badge bg-danger">Annulée</span>
							{% endif %}
						</p>
						<p>
							<strong>Nombre d'articles :</strong>
							<span class="badge bg-primary">{{ order.orderItem|length }}</span>
						</p>
						<p class="mb-0">
							<strong>Créé le :</strong>
							{{ order.createdAt|date('d/m/Y à H:i') }}
						</p>
					</div>
				</div>
			</div>

			<div class="col-md-6 mb-4">
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">Informations client</h5>
					</div>
					<div class="card-body">
						{% if order.customer %}
							<p>
								<strong>Nom :</strong>
								{{ order.customer.lastName }}
							</p>
							<p>
								<strong>Prénom :</strong>
								{{ order.customer.firstName }}
							</p>
							<p class="mb-0">
								<strong>Email :</strong>
								<a href="mailto:{{ order.customer.email }}">{{ order.customer.email }}</a>
							</p>
						{% else %}
							<p class="text-muted mb-0">Aucun client associé</p>
						{% endif %}
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 mb-4">
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0">Articles de la commande</h5>
					</div>
					<div class="card-body">
						{% if order.orderItem|length > 0 %}
							<table class="table table-striped">
								<thead>
									<tr>
										<th>Produit</th>
										<th class="text-end">Prix unitaire</th>
										<th class="text-center">Quantité</th>
										<th class="text-end">Sous-total</th>
									</tr>
								</thead>
								<tbody>
									{% set total = 0 %}
									{% for item in order.orderItem %}
										{% set subtotal = item.productPrice * item.quantity %}
										{% set total = total + subtotal %}
										<tr>
											<td>
												{% if item.product %}
													{{ item.product.name }}
												{% else %}
													<span class="text-muted">Produit supprimé</span>
												{% endif %}
											</td>
											<td class="text-end">{{ item.productPrice|number_format(2, ',', ' ') }} €</td>
											<td class="text-center">{{ item.quantity }}</td>
											<td class="text-end">{{ subtotal|number_format(2, ',', ' ') }} €</td>
										</tr>
									{% endfor %}
								</tbody>
								<tfoot>
									<tr class="fw-bold">
										<td colspan="3" class="text-end">Total :</td>
										<td class="text-end">{{ total|number_format(2, ',', ' ') }} €</td>
									</tr>
								</tfoot>
							</table>
						{% else %}
							<p class="text-muted mb-0">Aucun article dans cette commande</p>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
